"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[792],{56:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},72:e=>{var t=[];function n(e){for(var n=-1,o=0;o<t.length;o++)if(t[o].identifier===e){n=o;break}return n}function o(e,o){for(var i={},s=[],a=0;a<e.length;a++){var c=e[a],d=o.base?c[0]+o.base:c[0],l=i[d]||0,h="".concat(d," ").concat(l);i[d]=l+1;var p=n(h),u={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==p)t[p].references++,t[p].updater(u);else{var m=r(u,o);o.byIndex=a,t.splice(a,0,{identifier:h,updater:m,references:1})}s.push(h)}return s}function r(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,r){var i=o(e=e||[],r=r||{});return function(e){e=e||[];for(var s=0;s<i.length;s++){var a=n(i[s]);t[a].references--}for(var c=o(e,r),d=0;d<i.length;d++){var l=n(i[d]);0===t[l].references&&(t[l].updater(),t.splice(l,1))}i=c}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},122:(e,t,n)=>{var o=n(72),r=n.n(o),i=n(825),s=n.n(i),a=n(659),c=n.n(a),d=n(56),l=n.n(d),h=n(540),p=n.n(h),u=n(113),m=n.n(u),g=n(249),y={};y.styleTagTransform=m(),y.setAttributes=l(),y.insert=c().bind(null,"head"),y.domAPI=s(),y.insertStyleElement=p(),r()(g.A,y),g.A&&g.A.locals&&g.A.locals;class w{getLoadingTemplate(){return'\n            <div class="loading">\n                <p>Loading stories...</p>\n            </div>\n        '}getTemplate(){return'\n            <section class="hero">\n                <h2>Share Your Stories</h2>\n                <p>Discover amazing experiences from people around the world</p>\n                <a href="#/stories" class="btn">Explore Stories</a>\n                <a href="#/add-story" class="btn secondary">Share Your Story</a>\n            </section>\n            \n            <section class="featured-stories">\n                <h3>Featured Stories</h3>\n                <div id="stories-map" class="map-container" style="height: 400px; margin-bottom: 2rem;"></div>\n                <div id="stories-list" class="stories-grid"></div>\n                <div id="error-container"></div>\n            </section>\n        '}showStories(e){const t=document.getElementById("stories-list");t&&(t.innerHTML=e.map((e=>`\n            <article class="story-card">\n                <a href="#/stories/${e.id}">\n                    <img src="${e.photoUrl}" alt="${e.description.substring(0,50)}" class="story-image">\n                    <div class="story-content">\n                        <h4>${e.name}'s Story</h4>\n                        <p>${e.description.substring(0,100)}...</p>\n                        <time datetime="${e.createdAt}">${new Date(e.createdAt).toLocaleDateString()}</time>\n                    </div>\n                </a>\n            </article>\n        `)).join(""),this.initMapForStories(e))}initMapForStories(e){const t=document.getElementById("stories-map");if(!t||0===e.length)return;const n=L.map(t).setView([0,0],2);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(n);const o=e.filter((e=>e.lat&&e.lon));if(o.length>0){const e=[];o.forEach((t=>{L.marker([t.lat,t.lon]).addTo(n).bindPopup(`\n                    <b>${t.name}'s Story</b><br>\n                    ${t.description.substring(0,100)}...\n                    <a href="#/stories/${t.id}">Read more</a>\n                `),e.push([t.lat,t.lon])})),n.fitBounds(e)}}showError(e){const t=document.getElementById("error-container")||document.getElementById("stories-list");t&&(t.innerHTML=`\n            <div class="error-message">\n                <p>${e}</p>\n                ${e.includes("login")||e.includes("authentication")?'<a href="#/login" class="btn">Login to View Stories</a>':""}\n            </div>\n        `)}}class v{constructor({viewContainer:e,storyModel:t,authModel:n}){this._view=new w,this._viewContainer=e,this._storyModel=t,this._authModel=n}async show(){try{if(this._viewContainer.innerHTML=this._view.getTemplate(),!this._authModel.getToken())return this._view.showError("Silakan login terlebih dahulu"),void setTimeout((()=>window.location.hash="#/login"),1500);document.getElementById("stories-list").innerHTML="<p>Memuat cerita...</p>";const e=await this._storyModel.getAllStories();this._view.showStories(e)}catch(e){console.error("Error:",e),this._view.showError(e.message.includes("auth")?"Sesi habis, silakan login ulang":"Gagal memuat cerita"),this._authModel.getToken()||(window.location.hash="#/login")}}}const f=class{getTemplate(){return'\n            <section class="stories-section">\n                <h2>All Stories</h2>\n                <div id="stories-list" class="stories-list"></div>\n                <div id="map-container" class="map-container"></div>\n            </section>\n        '}getDetailTemplate(){return'\n            <section class="story-detail-section">\n                <div id="story-detail"></div>\n                <div id="story-map" class="map-container"></div>\n                <a href="#/stories" class="btn back-button">Back to Stories</a>\n            </section>\n        '}showStories(e){document.getElementById("stories-list").innerHTML=e.map((e=>`\n            <article class="story-item">\n                <a href="#/stories/${e.id}">\n                    <img src="${e.photoUrl}" alt="${e.description.substring(0,50)}" class="story-image">\n                    <div class="story-info">\n                        <h3>${e.name}'s Story</h3>\n                        <p>${e.description.substring(0,150)}...</p>\n                        <div class="story-meta">\n                            <time datetime="${e.createdAt}">${new Date(e.createdAt).toLocaleDateString()}</time>\n                            <span>${e.lat?"üìç Has Location":""}</span>\n                        </div>\n                    </div>\n                </a>\n            </article>\n        `)).join("")}showStoryDetail(e){document.getElementById("story-detail").innerHTML=`\n            <article class="story-detail">\n                <img src="${e.photoUrl}" alt="${e.description}" class="detail-image">\n                <div class="detail-content">\n                    <h3>${e.name}'s Story</h3>\n                    <p>${e.description}</p>\n                    <div class="detail-meta">\n                        <time datetime="${e.createdAt}">Posted on ${new Date(e.createdAt).toLocaleDateString()}</time>\n                    </div>\n                </div>\n            </article>\n        `}initMapForStories(e){const t=document.getElementById("map-container");if(!t||0===e.length)return;const n=L.map(t).setView([0,0],2);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(n);const o=e.filter((e=>e.lat&&e.lon));if(o.length>0){const e=[];o.forEach((t=>{L.marker([t.lat,t.lon]).addTo(n).bindPopup(`\n                    <b>${t.name}'s Story</b><br>\n                    ${t.description.substring(0,100)}...\n                    <a href="#/stories/${t.id}">Read more</a>\n                `),e.push([t.lat,t.lon])})),n.fitBounds(e)}}initMapForStory(e){const t=document.getElementById("story-map");if(!t||!e.lat||!e.lon)return;const n=L.map(t).setView([e.lat,e.lon],13);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(n),L.marker([e.lat,e.lon]).addTo(n).bindPopup(`\n            <b>Story Location</b><br>\n            ${e.description.substring(0,100)}...\n        `).openPopup()}showError(e){const t=document.getElementById("stories-list")||document.getElementById("story-detail");t&&(t.innerHTML=`\n                <div class="error-message">\n                    <p>${e}</p>\n                </div>\n            `)}};class b{constructor({viewContainer:e,storyModel:t,authModel:n}){this._viewContainer=e,this._storyModel=t,this._authModel=n,this._view=new f}async show(){this._viewContainer.innerHTML=this._view.getTemplate();try{const e=await this._storyModel.getAllStories();this._view.showStories(e),this._view.initMapForStories(e)}catch(e){this._view.showError(e.message)}}async showDetail(e){this._viewContainer.innerHTML=this._view.getDetailTemplate();try{const t=await this._storyModel.getStoryById(e);this._view.showStoryDetail(t),this._view.initMapForStory(t)}catch(e){this._view.showError(e.message)}}}const _=class{getTemplate(){return'\n            <section class="add-story-section">\n                <h2>Share Your Story</h2>\n                <form id="story-form" class="story-form">\n                    <div class="form-group">\n                        <label for="story-photo">Story Photo</label>\n                        <div class="camera-preview" id="camera-preview" style="position: relative; border: 1px solid #ddd; padding: 1rem; margin-bottom: 1rem;">\n                            <video id="camera-view" autoplay playsinline style="width: 100%; max-height: 300px;"></video>\n                            <canvas id="photo-canvas" style="display: none;"></canvas>\n                            <img id="photo-preview" style="display: none; width: 100%; max-height: 300px; object-fit: contain;">\n                            <button type="button" id="capture-btn" class="btn" style="margin-top: 1rem;">Capture Photo</button>\n                        </div>\n                        <input type="file" id="photo-upload" accept="image/*" capture="camera" style="display: none;">\n                    </div>\n                    \n                    <div class="form-group">\n                        <label for="story-description">Description</label>\n                        <textarea id="story-description" required placeholder="Tell your story..."></textarea>\n                    </div>\n                    \n                    <div class="form-group">\n                        <label>Location (click on the map to set)</label>\n                        <div id="location-map" class="map-container" style="height: 300px;"></div>\n                        <div class="coordinates" style="margin-top: 0.5rem;">\n                            <span>Latitude: <span id="latitude-display">Not set</span></span>\n                            <span style="margin-left: 1rem;">Longitude: <span id="longitude-display">Not set</span></span>\n                        </div>\n                    </div>\n                    \n                    <button type="submit" class="btn">Share Story</button>\n                </form>\n            </section>\n            \n            <div id="notification" class="notification hidden"></div>\n        '}initCamera(){const e=document.getElementById("camera-view"),t=document.getElementById("photo-canvas"),n=document.getElementById("photo-preview"),o=document.getElementById("capture-btn"),r=document.getElementById("photo-upload");let i=null;navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({video:!0}).then((t=>{i=t,e.srcObject=i})).catch((e=>{console.error("Camera access error:",e),r.style.display="block",o.style.display="none"})):(r.style.display="block",o.style.display="none"),o.addEventListener("click",(()=>{t.width=e.videoWidth,t.height=e.videoHeight,t.getContext("2d").drawImage(e,0,0,t.width,t.height),n.src=t.toDataURL("image/jpeg"),n.style.display="block",e.style.display="none",o.style.display="none",i&&i.getTracks().forEach((e=>e.stop()))})),r.addEventListener("change",(t=>{const r=t.target.files[0];if(r){const t=new FileReader;t.onload=t=>{n.src=t.target.result,n.style.display="block",e.style.display="none",o.style.display="none",i&&i.getTracks().forEach((e=>e.stop()))},t.readAsDataURL(r)}}))}initMap(){const e=document.getElementById("location-map");if(!e)return;const t=L.map(e).setView([0,0],2);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(t);let n=null;t.on("click",(e=>{const{lat:o,lng:r}=e.latlng;document.getElementById("latitude-display").textContent=o.toFixed(4),document.getElementById("longitude-display").textContent=r.toFixed(4),n&&t.removeLayer(n),n=L.marker([o,r]).addTo(t).bindPopup("Story location").openPopup()}))}setSubmitHandler(e){document.getElementById("story-form").addEventListener("submit",(async t=>{t.preventDefault();const n=document.getElementById("photo-canvas"),o=document.getElementById("story-description").value,r=parseFloat(document.getElementById("latitude-display").textContent),i=parseFloat(document.getElementById("longitude-display").textContent);n&&0!==n.width?o?n.toBlob((async t=>{try{await e({photo:t,description:o,lat:isNaN(r)?null:r,lon:isNaN(i)?null:i})}catch(e){this.showError(e.message)}}),"image/jpeg"):this.showError("Please enter a description"):this.showError("Please capture or upload a photo")}))}showSuccess(e){const t=document.getElementById("notification");t.textContent=e,t.classList.remove("error"),t.classList.remove("hidden"),t.classList.add("success"),setTimeout((()=>{t.classList.add("hidden")}),3e3)}showError(e){const t=document.getElementById("notification");t.textContent=e,t.classList.remove("success"),t.classList.remove("hidden"),t.classList.add("error"),setTimeout((()=>{t.classList.add("hidden")}),3e3)}},S=class{constructor({viewContainer:e,storyModel:t,authModel:n}){this._viewContainer=e,this._storyModel=t,this._authModel=n,this._view=new _}async show(){await this._authModel.checkAuthState()?(this._viewContainer.innerHTML=this._view.getTemplate(),this._view.initCamera(),this._view.initMap(),this._view.setSubmitHandler((async e=>{try{const t=this._authModel.getToken();await this._storyModel.addStory(e,t),this._view.showSuccess("Story added successfully!"),setTimeout((()=>{window.location.hash="#/stories"}),1500)}catch(e){this._view.showError(e.message)}}))):window.location.hash="#/login"}},x=class{getLoginTemplate(){return'\n            <section class="auth-section">\n                <h2>Login</h2>\n                <form id="login-form" class="auth-form">\n                    <div class="form-group">\n                        <label for="login-email">Email</label>\n                        <input type="email" id="login-email" required>\n                    </div>\n                    \n                    <div class="form-group">\n                        <label for="login-password">Password</label>\n                        <input type="password" id="login-password" required>\n                    </div>\n                    \n                    <button type="submit" class="btn">Login</button>\n                    <p>Don\'t have an account? <a href="#/register">Register</a></p>\n                </form>\n            </section>\n            \n            <div id="notification" class="notification hidden"></div>\n        '}getRegisterTemplate(){return'\n            <section class="auth-section">\n                <h2>Register</h2>\n                <form id="register-form" class="auth-form">\n                    <div class="form-group">\n                        <label for="register-name">Name</label>\n                        <input type="text" id="register-name" required>\n                    </div>\n                    \n                    <div class="form-group">\n                        <label for="register-email">Email</label>\n                        <input type="email" id="register-email" required>\n                    </div>\n                    \n                    <div class="form-group">\n                        <label for="register-password">Password</label>\n                        <input type="password" id="register-password" required minlength="6">\n                    </div>\n                    \n                    <button type="submit" class="btn">Register</button>\n                    <p>Already have an account? <a href="#/login">Login</a></p>\n                </form>\n            </section>\n            \n            <div id="notification" class="notification hidden"></div>\n        '}setLoginHandler(e){document.getElementById("login-form").addEventListener("submit",(async t=>{t.preventDefault();const n=document.getElementById("login-email").value,o=document.getElementById("login-password").value;try{await e(n,o)}catch(e){this.showError(e.message)}}))}setRegisterHandler(e){document.getElementById("register-form").addEventListener("submit",(async t=>{t.preventDefault();const n=document.getElementById("register-name").value,o=document.getElementById("register-email").value,r=document.getElementById("register-password").value;try{await e(n,o,r)}catch(e){this.showError(e.message)}}))}showSuccess(e){const t=document.getElementById("notification");t.textContent=e,t.classList.remove("error"),t.classList.remove("hidden"),t.classList.add("success"),setTimeout((()=>{t.classList.add("hidden")}),3e3)}showError(e){const t=document.getElementById("notification");t.textContent=e,t.classList.remove("success"),t.classList.remove("hidden"),t.classList.add("error"),setTimeout((()=>{t.classList.add("hidden")}),3e3)}},k=class{constructor({viewContainer:e,authModel:t}){this._viewContainer=e,this._authModel=t,this._view=new x}showLogin(){this._viewContainer.innerHTML=this._view.getLoginTemplate(),this._view.setLoginHandler((async(e,t)=>{try{await this._authModel.login(e,t),this._view.showSuccess("Login successful!"),setTimeout((()=>{window.location.hash="#/home"}),1500)}catch(e){this._view.showError(e.message)}}))}showRegister(){this._viewContainer.innerHTML=this._view.getRegisterTemplate(),this._view.setRegisterHandler((async(e,t,n)=>{try{await this._authModel.register(e,t,n),this._view.showSuccess("Registration successful! Please login."),setTimeout((()=>{window.location.hash="#/login"}),1500)}catch(e){this._view.showError(e.message)}}))}},E="https://story-api.dicoding.dev/v1";class T{constructor(){this.dbName="StoryDatabase",this.storeName="stories",this.db=null,this.initDB()}initDB(){return new Promise(((e,t)=>{const n=indexedDB.open(this.dbName,1);n.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(this.storeName)||t.createObjectStore(this.storeName,{keyPath:"id"})},n.onsuccess=t=>{this.db=t.target.result,e(this.db)},n.onerror=e=>{console.error("IndexedDB error:",e.target.error),t(e.target.error)}}))}async saveStory(e){return new Promise(((t,n)=>{const o=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).put(e);o.onsuccess=()=>t(),o.onerror=e=>n(e.target.error)}))}async saveMultipleStories(e){return Promise.all(e.map((e=>this.saveStory(e))))}async getStories(){return new Promise(((e,t)=>{const n=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).getAll();n.onsuccess=()=>e(n.result),n.onerror=e=>t(e.target.error)}))}async getStoryById(e){return new Promise(((t,n)=>{const o=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).get(e);o.onsuccess=()=>t(o.result),o.onerror=e=>n(e.target.error)}))}async deleteStory(e){return new Promise(((t,n)=>{const o=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).delete(e);o.onsuccess=()=>t(),o.onerror=e=>n(e.target.error)}))}async clearStories(){return new Promise(((e,t)=>{const n=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).clear();n.onsuccess=()=>e(),n.onerror=e=>t(e.target.error)}))}}class M{constructor(e){this._authModel=e,this._database=new T,this._syncQueue=[],this._isSyncing=!1}async getAllStories(){try{const e=this._authModel.getToken();if(!e)throw new Error("Missing authentication");try{const t=await fetch(`${E}/stories`,{headers:{Authorization:`Bearer ${e}`}}),n=await t.json();if(!t.ok)throw 401===t.status&&this._authModel.logout(),new Error(n.message||"Failed to fetch stories");return await this._database.saveMultipleStories(n.listStory),this._processSyncQueue(),n.listStory}catch(e){console.log("Network failed, using cached data:",e);const t=await this._database.getStories();if(t.length>0)return t;throw new Error("No internet connection and no cached stories available")}}catch(e){throw console.error("Error fetching stories:",e),e}}async getStoryById(e){try{if(navigator.onLine){const t=this._authModel.getToken(),n=t?{Authorization:`Bearer ${t}`}:{},o=await fetch(`${E}/stories/${e}`,{headers:n}),r=await o.json();if(o.ok)return await this._database.saveStory(r.story),r.story}const t=await this._database.getStoryById(e);if(t)return t;throw new Error("Story not found")}catch(e){throw console.error("Error fetching story:",e),e}}async addStory({photo:e,description:t,lat:n,lon:o}){try{const r=this._authModel.getToken();if(!r)throw new Error("Missing authentication");const i=new FormData;if(i.append("photo",e),i.append("description",t),n&&i.append("lat",n),o&&i.append("lon",o),!navigator.onLine){const r={id:`offline-${Date.now()}`,photo:e,description:t,lat:n,lon:o,createdAt:(new Date).toISOString(),isOffline:!0};return await this._database.saveStory(r),this._addToSyncQueue(r),{message:"Story saved offline and will be synced when online",story:r}}const s=await fetch(`${E}/stories`,{method:"POST",headers:{Authorization:`Bearer ${r}`},body:i}),a=await s.json();if(!s.ok)throw new Error(a.message);return this._sendPushNotification({title:"New Story Added",body:t.substring(0,100)+"..."}),a}catch(e){throw console.error("Error adding story:",e),e}}async _processSyncQueue(){if(this._isSyncing||0===this._syncQueue.length)return;this._isSyncing=!0;const e=this._authModel.getToken();try{for(;this._syncQueue.length>0;){const t=this._syncQueue[0],n=new FormData;if(n.append("photo",t.photo),n.append("description",t.description),t.lat&&n.append("lat",t.lat),t.lon&&n.append("lon",t.lon),!(await fetch(`${E}/stories`,{method:"POST",headers:{Authorization:`Bearer ${e}`},body:n})).ok)break;this._syncQueue.shift(),await this._database.deleteStory(t.id)}}catch(e){console.error("Error syncing stories:",e)}finally{this._isSyncing=!1}}_addToSyncQueue(e){this._syncQueue.push(e),navigator.onLine&&this._processSyncQueue()}async _sendPushNotification(e){if("serviceWorker"in navigator&&"PushManager"in window)try{(await navigator.serviceWorker.ready).active.postMessage({type:"PUSH_NOTIFICATION",notification:e})}catch(e){console.error("Error sending push notification:",e)}}}const B="https://story-api.dicoding.dev/v1";class I{async login(e,t){try{const n=await fetch(`${B}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),o=await n.json();if(!n.ok)throw new Error(o.message);return localStorage.setItem("token",o.loginResult.token),localStorage.setItem("user",JSON.stringify(o.loginResult)),o}catch(e){throw console.error("Login error:",e),e}}async register(e,t,n){try{const o=await fetch(`${B}/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,email:t,password:n})}),r=await o.json();if(!o.ok)throw new Error(r.message);return r}catch(e){throw console.error("Registration error:",e),e}}logout(){localStorage.removeItem("token"),localStorage.removeItem("user")}async checkAuthState(){const e=localStorage.getItem("token");if(!e)return!1;try{return(await fetch(`${B}/stories`,{headers:{Authorization:`Bearer ${e}`}})).ok}catch(e){return!1}}getCurrentUser(){const e=localStorage.getItem("user");return e?JSON.parse(e):null}getToken(){return localStorage.getItem("token")}}class N{constructor(){this.dbName="StoryShareDB",this.storeName="stories",this.db=null,this.initDB()}initDB(){return new Promise(((e,t)=>{const n=indexedDB.open(this.dbName,1);n.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(this.storeName)||t.createObjectStore(this.storeName,{keyPath:"id"})},n.onsuccess=t=>{this.db=t.target.result,e(this.db)},n.onerror=e=>{console.error("IndexedDB error:",e.target.error),t(e.target.error)}}))}async saveStory(e){return new Promise(((t,n)=>{const o=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).put(e);o.onsuccess=()=>t(),o.onerror=e=>n(e.target.error)}))}async getStories(){return new Promise(((e,t)=>{const n=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).getAll();n.onsuccess=()=>e(n.result),n.onerror=e=>t(e.target.error)}))}async deleteStory(e){return new Promise(((t,n)=>{const o=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).delete(e);o.onsuccess=()=>t(),o.onerror=e=>n(e.target.error)}))}}function A(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),n=window.atob(t),o=new Uint8Array(n.length);for(let e=0;e<n.length;++e)o[e]=n.charCodeAt(e);return o}class C{constructor(){this._authModel=new I,this._storyModel=new M(this._authModel),this._database=new N,this._initPresenters(),this._setupEventHandlers(),this._checkAuthState(),this._registerServiceWorker(),console.log("[APP] Application initialized"),this._setupInstallButton()}_setupInstallButton(){this.installButton=document.createElement("button"),this.installButton.id="install-btn",this.installButton.textContent="Install App",this.installButton.style.display="none",document.querySelector(".app-header").appendChild(this.installButton),window.addEventListener("beforeinstallprompt",(e=>{e.preventDefault(),this.deferredPrompt=e,this.installButton.style.display="block"})),this.installButton.addEventListener("click",(async()=>{if(!this.deferredPrompt)return;this.deferredPrompt.prompt();const{outcome:e}=await this.deferredPrompt.userChoice;"accepted"===e&&(this.installButton.style.display="none"),this.deferredPrompt=null})),window.addEventListener("appinstalled",(()=>{this.installButton.style.display="none"}))}async _registerServiceWorker(){if("serviceWorker"in navigator)try{const e=await navigator.serviceWorker.register("/service-worker.js");console.log("ServiceWorker registration successful"),this._authModel.getToken()&&this._initPushNotifications(e)}catch(e){console.log("ServiceWorker registration failed: ",e)}}async _initPushNotifications(e){if("Notification"in window&&"PushManager"in window)try{if("granted"===await Notification.requestPermission()){const t=await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:A("BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk")});await fetch("https://story-api.dicoding.dev/v1/push-subscriptions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._authModel.getToken()}`},body:JSON.stringify(t)})}}catch(e){console.error("Push notification error:",e)}}_initPresenters(){const e={storyModel:this._storyModel,authModel:this._authModel,database:this._database,viewContainer:document.getElementById("app-view"),onNavigation:e=>this._navigateTo(e)};this._presenters={home:new v(e),story:new b({...e,onStoryLoaded:()=>this._updateNavIndicator()}),addStory:new S(e),auth:new k({...e,onAuthSuccess:()=>{this._checkAuthState(),this._navigateTo("home"),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((e=>{this._initPushNotifications(e)}))}})}}_setupEventHandlers(){this._hashChangeHandler=()=>{const e=window.location.hash;console.log("[ROUTE] Hash changed:",e),this._route()},window.addEventListener("hashchange",this._hashChangeHandler),this._clickHandler=e=>{const t=e.target.closest(".nav-link");t&&(t.classList.add("active"),setTimeout((()=>t.classList.remove("active")),100))},document.addEventListener("click",this._clickHandler),this._route(),window.addEventListener("beforeinstallprompt",(e=>{e.preventDefault(),this._deferredPrompt=e}))}_cleanupEventHandlers(){window.removeEventListener("hashchange",this._hashChangeHandler),document.removeEventListener("click",this._clickHandler)}async _route(){try{const e=window.location.hash;if(!e||"#"===e)return this._navigateTo("home");const[,t,n]=e.split("/");if(console.log("[ROUTE] Navigating to:",t||"home",n),!navigator.onLine&&"home"!==t)return this._presenters.home.showError("You are offline. Some features may not be available."),this._navigateTo("home");document.startViewTransition?await document.startViewTransition((()=>this._handleRoute(t,n))).finished:await this._handleRoute(t,n)}catch(e){console.error("[ROUTE] Error:",e),this._presenters.home.showError("Failed to load page")}}async _handleRoute(e,t){if(!e)return this._navigateTo("home");if(["add-story","stories"].includes(e)&&!this._authModel.getToken())return console.log("[AUTH] Redirecting to login"),this._navigateTo("login");switch(e){case"":case"home":await this._presenters.home.show();break;case"stories":t?await this._presenters.story.showDetail(t):await this._presenters.story.show();break;case"add-story":await this._presenters.addStory.show();break;case"login":await this._presenters.auth.showLogin();break;case"register":await this._presenters.auth.showRegister();break;case"logout":await this._authModel.logout(),this._navigateTo("home");break;default:console.warn("[ROUTE] Unknown route:",e),await this._presenters.home.show()}this._updateNavIndicator()}_navigateTo(e){window.location.hash=`#/${e}`}async _checkAuthState(){try{const e=await this._authModel.checkAuthState();this._updateAuthUI(e)}catch(e){console.error("[AUTH] Check failed:",e),this._updateAuthUI(!1)}}_updateAuthUI(e){const t=document.getElementById("auth-link");t&&(t.textContent=e?"Logout":"Login",t.setAttribute("href",e?"#/logout":"#/login"))}_updateNavIndicator(){document.querySelectorAll(".nav-link").forEach((e=>{const t=e.getAttribute("href"),n=window.location.hash,o="#/home"===t&&("#"===n||"#/"===n||""===n)||t===n;e.setAttribute("aria-current",o?"page":"false"),e.classList.toggle("active",o)}))}destroy(){this._cleanupEventHandlers()}}document.addEventListener("DOMContentLoaded",(()=>{let e;try{if(!document.getElementById("app-view"))throw new Error("Missing app-view container");e=new C}catch(e){console.error("[BOOT] Failed to start:",e),document.body.innerHTML=`\n      <div class="error-screen">\n        <h1>Application Error</h1>\n        <p>${e.message}</p>\n        <button onclick="window.location.reload()">Reload</button>\n      </div>\n    `}})),document.addEventListener("DOMContentLoaded",(async()=>{const e=new C({content:document.querySelector("#main-content"),drawerButton:document.querySelector("#drawer-button"),navigationDrawer:document.querySelector("#navigation-drawer")});await e._route(),await e._registerServiceWorker(),console.log("Berhasil mendaftarkan service worker."),window.addEventListener("hashchange",(async()=>{await e._route()}))}))},249:(e,t,n)=>{n.d(t,{A:()=>a});var o=n(601),r=n.n(o),i=n(314),s=n.n(i)()(r());s.push([e.id,"/* Base Styles */\n:root {\n    --primary-color: #4a6fa5;\n    --secondary-color: #166088;\n    --accent-color: #4fc3f7;\n    --background-color: #f8f9fa;\n    --text-color: #333;\n    --light-text: #666;\n    --error-color: #e53935;\n    --success-color: #43a047;\n}\n\n* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    line-height: 1.6;\n    color: var(--text-color);\n    background-color: var(--background-color);\n}\n\na {\n    text-decoration: none;\n    color: var(--primary-color);\n}\n\nimg {\n    max-width: 100%;\n    height: auto;\n}\n\n/* Layout */\n.app-header {\n    background-color: white;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n    padding: 1rem;\n    position: sticky;\n    top: 0;\n    z-index: 100;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n\n.app-header h1 {\n    color: var(--primary-color);\n}\n\n.navigation ul {\n    display: flex;\n    list-style: none;\n}\n\n.navigation li {\n    margin-left: 1.5rem;\n}\n\n.nav-link {\n    padding: 0.5rem 1rem;\n    border-radius: 4px;\n    transition: background-color 0.3s;\n}\n\n.nav-link:hover {\n    background-color: rgba(74, 111, 165, 0.1);\n}\n\nfooter {\n    text-align: center;\n    padding: 1rem;\n    margin-top: 2rem;\n    background-color: white;\n    box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.1);\n}\n\n/* Buttons */\n.btn {\n    display: inline-block;\n    padding: 0.6rem 1.2rem;\n    background-color: var(--primary-color);\n    color: white;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    transition: background-color 0.3s;\n}\n\n.btn:hover {\n    background-color: var(--secondary-color);\n}\n\n.btn.secondary {\n    background-color: white;\n    color: var(--primary-color);\n    border: 1px solid var(--primary-color);\n}\n\n.btn.secondary:hover {\n    background-color: rgba(74, 111, 165, 0.1);\n}\n\n.back-button {\n    margin-top: 1rem;\n}\n\n/* Forms */\n.auth-form, .story-form {\n    max-width: 500px;\n    margin: 2rem auto;\n    padding: 1.5rem;\n    background-color: white;\n    border-radius: 8px;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n}\n\n.form-group {\n    margin-bottom: 1.5rem;\n}\n\n.form-group label {\n    display: block;\n    margin-bottom: 0.5rem;\n    font-weight: 500;\n}\n\n.form-group input,\n.form-group textarea {\n    width: 100%;\n    padding: 0.8rem;\n    border: 1px solid #ddd;\n    border-radius: 4px;\n    font-family: inherit;\n}\n\n.form-group textarea {\n    min-height: 120px;\n    resize: vertical;\n}\n\n/* Stories */\n.stories-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));\n    gap: 1.5rem;\n    margin-top: 1.5rem;\n}\n\n.story-card {\n    background-color: white;\n    border-radius: 8px;\n    overflow: hidden;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n    transition: transform 0.3s;\n}\n\n.story-card:hover {\n    transform: translateY(-5px);\n}\n\n.story-image {\n    width: 100%;\n    height: 200px;\n    object-fit: cover;\n}\n\n.story-content {\n    padding: 1rem;\n}\n\n.story-content h4 {\n    margin-bottom: 0.5rem;\n    color: var(--primary-color);\n}\n\n.story-content time {\n    font-size: 0.9rem;\n    color: var(--light-text);\n}\n\n.story-item {\n    display: flex;\n    margin-bottom: 1.5rem;\n    background-color: white;\n    border-radius: 8px;\n    overflow: hidden;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n}\n\n.story-item .story-image {\n    width: 150px;\n    height: 150px;\n    object-fit: cover;\n}\n\n.story-info {\n    padding: 1rem;\n    flex: 1;\n}\n\n.story-info h3 {\n    color: var(--primary-color);\n    margin-bottom: 0.5rem;\n}\n\n.story-meta {\n    display: flex;\n    justify-content: space-between;\n    margin-top: 0.5rem;\n    font-size: 0.9rem;\n    color: var(--light-text);\n}\n\n.story-detail {\n    background-color: white;\n    border-radius: 8px;\n    overflow: hidden;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n    margin-bottom: 1.5rem;\n}\n\n.detail-image {\n    width: 100%;\n    max-height: 400px;\n    object-fit: cover;\n}\n\n.detail-content {\n    padding: 1.5rem;\n}\n\n.detail-content h3 {\n    color: var(--primary-color);\n    margin-bottom: 1rem;\n}\n\n.detail-meta {\n    margin-top: 1rem;\n    font-size: 0.9rem;\n    color: var(--light-text);\n}\n\n/* Map */\n.map-container {\n    height: 400px;\n    margin: 1.5rem 0;\n    border-radius: 8px;\n    overflow: hidden;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n}\n\n/* Add Story */\n.camera-preview {\n    margin-bottom: 1rem;\n    position: relative;\n}\n\n#camera-view {\n    width: 100%;\n    max-height: 300px;\n    background-color: #eee;\n    border-radius: 4px;\n}\n\n#capture-btn {\n    position: absolute;\n    bottom: 1rem;\n    left: 50%;\n    transform: translateX(-50%);\n    background-color: rgba(0, 0, 0, 0.7);\n}\n\n.coordinates {\n    display: flex;\n    justify-content: space-between;\n    margin-top: 0.5rem;\n    font-size: 0.9rem;\n    color: var(--light-text);\n}\n\n/* Notifications */\n.notification {\n    position: fixed;\n    top: 1rem;\n    right: 1rem;\n    padding: 1rem;\n    border-radius: 4px;\n    color: white;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n    z-index: 1000;\n    opacity: 1;\n    transition: opacity 0.3s;\n}\n\n.notification.success {\n    background-color: var(--success-color);\n}\n\n.notification.error {\n    background-color: var(--error-color);\n}\n\n.notification.hidden {\n    opacity: 0;\n    pointer-events: none;\n}\n\n/* Skip Link */\n.skip-link {\n    position: absolute;\n    top: 10px;\n    left: 50%;\n    transform: translateX(-50%);\n    background-color: var(--primary-color);\n    color: white;\n    padding: 12px 24px;\n    border-radius: 4px;\n    z-index: 9999;\n    opacity: 0;\n    transition: opacity 0.3s, transform 0.3s;\n    text-align: center;\n    font-weight: bold;\n    box-shadow: 0 2px 8px rgba(0,0,0,0.2);\n}\n\n.skip-link:focus {\n    opacity: 1;\n    transform: translateX(-50%) translateY(10px);\n    outline: 3px solid var(--accent-color);\n    outline-offset: 2px;\n}\n\n.skip-link:hover {\n    background-color: var(--secondary-color);\n}\n\n/* styles/main.css */\n.error-message {\n    padding: 1rem;\n    background-color: #ffebee;\n    border: 1px solid var(--error-color);\n    border-radius: 4px;\n    color: var(--error-color);\n    text-align: center;\n}\n\n.error-message a.btn {\n    margin-top: 0.5rem;\n    display: inline-block;\n}\n\n.loading {\n    padding: 2rem;\n    text-align: center;\n    font-size: 1.2rem;\n}\n\n.error-message {\n    padding: 1rem;\n    background: #ffebee;\n    color: #c62828;\n    border-radius: 4px;\n    margin: 1rem 0;\n    text-align: center;\n}\n\n.error-message a.btn {\n    margin-top: 0.5rem;\n    display: inline-block;\n}\n/* View Trans*/\n\n#install-btn {\n  /* position: absolute; */\n  right: 20px;\n  top: 20px;\n  padding: 8px 16px;\n  background: #4285f4;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n  z-index: 1000;\n}\n\n#install-btn:hover {\n  background: #3367d6;\n}\n\n.app-header {\n  position: relative;\n}\n\n",""]);const a=s},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",o=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),o&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),o&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,o,r,i){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(o)for(var a=0;a<this.length;a++){var c=this[a][0];null!=c&&(s[c]=!0)}for(var d=0;d<e.length;d++){var l=[].concat(e[d]);o&&s[l[0]]||(void 0!==i&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=i),n&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=n):l[2]=n),r&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=r):l[4]="".concat(r)),t.push(l))}},t}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},601:e=>{e.exports=function(e){return e[1]}},659:e=>{var t={};e.exports=function(e,n){var o=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(n)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var o="";n.supports&&(o+="@supports (".concat(n.supports,") {")),n.media&&(o+="@media ".concat(n.media," {"));var r=void 0!==n.layer;r&&(o+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),o+=n.css,r&&(o+="}"),n.media&&(o+="}"),n.supports&&(o+="}");var i=n.sourceMap;i&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),t.styleTagTransform(o,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}}},e=>{e(e.s=122)}]);